       IDENTIFICATION DIVISION.
       PROGRAM-ID. PAY002.
       AUTHOR. SID WAITE.
       DATE-COMPILED. TODAY.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT PAYMASTER ASSIGN TO "S30"
           ORGANIZATION LINE SEQUENTIAL.
           SELECT FILEOUT ASSIGN TO "S35"
           ORGANIZATION LINE SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.
       FD  PAYMASTER.
       01  PAYMASTER01.
           02 ACCT.
             03 ACCT1 PIC XX.
             03 ACCT2 PIC XXX.
           02 NAME PIC X(24).
           02 DATEX.
             03 DATEXYY PIC XX.
             03 DATEXMM PIC 99.
             03 DATEXDD PIC XX.
           02 GROSS PIC 9(5)V99.
           02 FED PIC 9(5)V99.
           02 FICA PIC 9(5)V99.
           02 STATE PIC 9(5)V99.
           02 NET PIC 9(5)V99.
           02 FILLER PIC X(15) VALUE SPACE.
       FD  FILEOUT
           DATA RECORD IS FILEOUT01.
       01  FILEOUT01 PIC X(133).
       WORKING-STORAGE SECTION.
       01  LINE-1.
           02 FO-SS PIC X(12).
           02 FILLER PIC X VALUE SPACES.
           02 FO-NAME PIC X(24).
           02 FILLER PIC X VALUE SPACE.
           02 FO-GROSS PIC ZZ,ZZ9.99.
        01  LINE-2.
            02 L2-DESC PIC X(35).
            02 FILLER PIC X VALUE SPACE.
            02 L2-AMT PIC ZZ,ZZ9.99.
       01  THISQRTR PIC 9.
       01  SOFAR PIC S9(5)V99.
       01  THISQRTRPAY PIC S9(5)V99.
       01  UNTAXED PIC S9(5)V99.
       01  TOTALUNTAXED PIC S9(5)V99 VALUE 0.
       01  TOTALPAYROLL PIC S9(5)V99 VALUE 0.
       01  HOLDNAME PIC X(24).
       01  HOLDACCT PIC XX.
       01  ALF3.
           02 QRTR PIC 9.
           02 THISYEAR PIC XX.
       PROCEDURE DIVISION.
       0005-START.
           OPEN INPUT PAYMASTER.
           OPEN OUTPUT FILEOUT.
           DISPLAY "QRTR AND YEAR QYY-FORMAT"
           ACCEPT ALF3.

       P0. READ PAYMASTER AT END GO TO P2.
       P0-1. IF DATEXYY NOT = THISYEAR GO TO P0.
           MOVE 1 TO THISQRTR
           IF DATEXMM > 3 MOVE 2 TO THISQRTR.
           IF DATEXMM > 6 MOVE 3 TO THISQRTR.
           IF DATEXMM > 9 MOVE 4 TO THISQRTR.
           MOVE 0 TO SOFAR THISQRTRPAY
           MOVE ACCT1 TO HOLDACCT
           MOVE NAME TO HOLDNAME
           GO TO P1-1.
       P1. READ PAYMASTER AT END PERFORM A1 PERFORM A2 GO TO P2.
           IF ACCT1 NOT = HOLDACCT PERFORM A1 GO TO P0-1.
           IF DATEXYY NOT = THISYEAR GO TO P1.
           MOVE 1 TO THISQRTR
           IF DATEXMM > 3 MOVE 2 TO THISQRTR.
           IF DATEXMM > 6 MOVE 3 TO THISQRTR.
           IF DATEXMM > 9 MOVE 4 TO THISQRTR.
       P1-1. 
           IF THISQRTR < QRTR
           ADD GROSS TO SOFAR.
           IF THISQRTR = QRTR
           ADD GROSS TO THISQRTRPAY.
           GO TO P1.
       A1. IF SOFAR NOT < 8000.00 MOVE 0 TO UNTAXED
           ELSE
           COMPUTE UNTAXED = 8000 - SOFAR
             IF UNTAXED > THISQRTRPAY MOVE THISQRTRPAY TO UNTAXED
             END-IF
           END-IF.
           ADD THISQRTRPAY TO TOTALPAYROLL
           ADD UNTAXED TO TOTALUNTAXED
           MOVE SPACE TO FO-SS
           IF HOLDACCT = "04" MOVE "009-30-3736" TO FO-SS.
           IF HOLDACCT = "05" MOVE "008-56-3909" TO FO-SS.
           IF HOLDACCT = "06" MOVE "009-46-8111" TO FO-SS.
           IF HOLDACCT = "07" MOVE "009-60-8073" TO FO-SS.
           MOVE THISQRTRPAY TO FO-GROSS
           MOVE HOLDNAME TO FO-NAME
           WRITE FILEOUT01 FROM LINE-1.
       A2. 
           MOVE SPACE TO L2-DESC
           MOVE TOTALPAYROLL TO L2-AMT
           STRING "QRTR  " QRTR " TOTAL PAYROLL    " L2-AMT DELIMITED
           BY "!!" INTO L2-DESC
           WRITE FILEOUT01 FROM LINE-2 AFTER 2
           MOVE SPACE TO L2-DESC
           COMPUTE TOTALPAYROLL = TOTALPAYROLL - TOTALUNTAXED
           MOVE TOTALPAYROLL TO L2-AMT
           STRING "QRTR  " QRTR " TOTAL EXEMPT     " L2-AMT DELIMITED
           BY "!!" INTO L2-DESC
           WRITE FILEOUT01 FROM LINE-2
           MOVE SPACE TO L2-DESC
           MOVE TOTALUNTAXED TO L2-AMT
           STRING "QRTR  " QRTR " TOTAL TAXABLE    " L2-AMT DELIMITED
           BY "!!" INTO L2-DESC
           WRITE FILEOUT01 FROM LINE-2 
           MOVE SPACE TO L2-DESC
           COMPUTE L2-AMT = TOTALUNTAXED * .004
           STRING "QRTR  " QRTR " TOTAL TAX @ .004 " L2-AMT DELIMITED
           BY "!!" INTO L2-DESC
           WRITE FILEOUT01 FROM LINE-2.
       P2.
           CLOSE PAYMASTER FILEOUT.
           STOP RUN.
