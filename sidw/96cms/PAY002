       IDENTIFICATION DIVISION.
       PROGRAM-ID. PAY002.
       AUTHOR. SID WAITE.
       DATE-COMPILED. TODAY.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT PAYMASTER ASSIGN TO "S30"
           ORGANIZATION LINE SEQUENTIAL.
           SELECT FILEOUT ASSIGN TO "S35"
           ORGANIZATION LINE SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.
       FD  PAYMASTER.
       01  PAYMASTER01.
           02 ACCT.
             03 ACCT1 PIC XX.
             03 ACCT2 PIC XXX.
           02 NAME PIC X(24).
           02 DATEX.
             03 DATEXYY PIC XX.
             03 DATEXMM PIC XX.
             03 DATEXDD PIC XX.
           02 GROSS PIC 9(5)V99.
           02 FED PIC 9(5)V99.
           02 FICA PIC 9(5)V99.
           02 STATE PIC 9(5)V99.
           02 NET PIC 9(5)V99.
           02 FILLER PIC X(15) VALUE SPACE.
       FD  FILEOUT
           DATA RECORD IS FILEOUT01.
       01  FILEOUT01 PIC X(133).
       WORKING-STORAGE SECTION.
       01  LINE-1.
           02 FO-DATE PIC X(6).
           02 FILLER PIC X VALUE SPACE.
           02 FO-GROSS PIC ZZZ,ZZ9.99.
           02 FILLER PIC X VALUE SPACE.
           02 FO-FED PIC ZZZ,ZZ9.99.
           02 FILLER PIC X VALUE SPACE.
           02 FO-FICA PIC ZZZ,ZZ9.99.
           02 FILLER PIC X VALUE SPACE.
           02 FO-STATE PIC ZZZ,ZZ9.99.
           02 FILLER PIC X VALUE SPACE.
           02 FO-NET PIC ZZZ,ZZ9.99.
           02 FILLER PIC X VALUE SPACE.
           02 FO-FEDTAX PIC ZZZ,ZZ9.99.
           02 FILLER PIC X VALUE SPACE.
           02 FO-ACCT PIC X(5).
           02 FILLER PIC X VALUE SPACE.
           02 FO-NAME PIC X(24).
           02 FILLER PIC X VALUE SPACE.
        01  LINE-2.
            02 L2-DATE PIC X(6).
            02 FILLER PIC X VALUE SPACE.
            02 L2-FEDTAX PIC ZZZ,ZZ9.99.
       01  HOLDDATE PIC X(6).
       01  HOLDMONTH PIC XX.
       01  FEDTAX PIC 9(6)V99 VALUE 0.
       01  DAYFEDTAX PIC 9(6)V99 VALUE 0.
       01  GRANDFEDTAX PIC 9(6)V99 VALUE 0.
       01  MONTHFEDTAX PIC 9(6)V99 VALUE 0.
       01  TOTFED PIC 9(6)V99 VALUE 0.
       01  TOTGROSS PIC 9(6)V99 VALUE 0.
       01  TOTSTATE PIC 9(6)V99 VALUE 0.
       01  TOTFICA PIC 9(6)V99 VALUE 0.
       01  TOTNET PIC 9(6)V99 VALUE 0.
       01  HEADER-1.
           02 FILLER PIC X(8) VALUE SPACE.
           02 FILLER PIC X(12) VALUE "TOT PAYROLL ".
           02 FILLER PIC X(8) VALUE "FED TAX "
           02 FILLER PIC X(9) VALUE "TOT FICA ".
           02 FILLER PIC X(14) VALUE "TOT STATE TAX ".
           02 FILLER PIC X(8) VALUE "NET PAY ".
           02 FILLER PIC X()  VALUE "TOT TAX DUE".

       PROCEDURE DIVISION.
       0005-START.
           OPEN INPUT PAYMASTER.
           OPEN OUTPUT FILEOUT.
           READ PAYMASTER AT END GO TO P3.
           MOVE DATEX TO HOLDDATE
           MOVE DATEXMM TO HOLDMONTH
           GO TO P1-1.
       P1. READ PAYMASTER AT END GO TO P3.
           IF DATEXMM NOT = HOLDMONTH PERFORM A1 PERFORM A2.
           IF DATEX NOT = HOLDDATE PERFORM A1.
       P1-1.
           ADD GROSS TO TOTGROSS
           ADD STATE TO TOTSTATE
           ADD FED TO TOTFED
           ADD FICA TO TOTFICA
           ADD NET TO TOTNET
           MOVE DATEX TO FO-DATE
           MOVE ACCT TO FO-ACCT
           MOVE NAME TO FO-NAME
           MOVE GROSS TO FO-GROSS
           MOVE FED TO FO-FED
           MOVE FICA TO FO-FICA
           MOVE STATE TO FO-STATE
           MOVE NET TO FO-NET
           COMPUTE FEDTAX = FED + ( .153 * GROSS)
           MOVE FEDTAX TO FO-FEDTAX
           ADD FEDTAX TO DAYFEDTAX
           WRITE FILEOUT01 FROM LINE-1
           GO TO P1.
       A1. ADD DAYFEDTAX TO MONTHFEDTAX
           MOVE HOLDDATE TO L2-DATE
           MOVE DAYFEDTAX TO L2-FEDTAX
           WRITE FILEOUT01 FROM LINE-2
      *     MOVE DATEXMM TO HOLDMONTH
           MOVE DATEX TO HOLDDATE
           MOVE 0 TO DAYFEDTAX
           MOVE SPACE TO FILEOUT01
           WRITE FILEOUT01.
       A2. ADD MONTHFEDTAX TO GRANDFEDTAX
           MOVE SPACE TO L2-DATE
           MOVE HOLDMONTH TO L2-DATE
           MOVE MONTHFEDTAX TO L2-FEDTAX
           WRITE FILEOUT01 FROM LINE-2 AFTER 2.
           MOVE DATEXMM TO HOLDMONTH
           MOVE DATEX TO HOLDDATE
           MOVE 0 TO MONTHFEDTAX.
       P3.
           PERFORM A1 PERFORM A2
           MOVE TOTGROSS TO FO-GROSS
           MOVE TOTFED TO FO-FED
           MOVE TOTFICA TO FO-FICA
           MOVE TOTSTATE TO FO-STATE
           MOVE TOTNET TO FO-NET
           MOVE SPACE TO FO-ACCT FO-NAME
           MOVE GRANDFEDTAX TO FO-FEDTAX
           
           WRITE FILEOUT01 FROM LINE-1.
           COMPUTE TOTSTATE = GRANDFEDTAX - TOTFED 
           MOVE TOTSTATE TO FO-GROSS
           COMPUTE TOTFED  = .124 * TOTGROSS
           COMPUTE TOTSTATE = TOTSTATE - TOTFED 
           MOVE TOTFED TO FO-FED
           MOVE TOTSTATE TO FO-FICA
           MOVE 0 TO FO-NET FO-STATE
           MOVE SPACE TO FO-NAME
           MOVE "S.S. / CARE" TO  FO-NAME
           WRITE FILEOUT01 FROM LINE-1.
           CLOSE PAYMASTER FILEOUT.
           STOP RUN.
